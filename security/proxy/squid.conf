# Squid forward proxy for openclaw bot container
# Only allows CONNECT (HTTPS) to allowlisted domains

acl allowed_domains dstdomain "/etc/squid/allowed-domains.txt"
acl SSL_ports port 443
acl CONNECT method CONNECT

# Allow HTTPS CONNECT to allowlisted domains only
http_access allow CONNECT SSL_ports allowed_domains
http_access deny all

# Listen on internal network only
http_port 3128

# Logging to tmpfs (accessible via docker exec)
access_log stdio:/var/log/squid/access.log
cache_log /var/log/squid/cache.log

# No caching
cache deny all

# Rate limiting: ~64KB/s sustained (prevents bulk exfil)
delay_pools 1
delay_class 1 1
delay_access 1 allow all
delay_parameters 1 64000/64000

# Connection limits
maximum_object_size 4 MB
client_lifetime 5 minutes
connect_timeout 30 seconds
read_timeout 60 seconds

# Identity
visible_hostname openclaw-proxy
